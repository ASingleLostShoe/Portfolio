<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>USFS LiDAR Canopy Height Models - Pat Hall</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="icon" type="image/svg+xml" href="../favicon.svg">
    <style>
        /* Override gallery styling to show full images */
        .gallery-grid img {
            height: auto;
            object-fit: contain;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="../index.html" class="nav-logo">Pat Hall</a>
            <ul class="nav-links">
                <li><a href="../index.html#about">about</a></li>
                <li><a href="../index.html#experience">experience</a></li>
                <li><a href="../index.html#portfolio">projects</a></li>
                <li><a href="../index.html#contact">contact</a></li>
            </ul>
        </div>
    </nav>

    <header class="project-hero">
        <div class="project-hero-image">
            <img src="../images/lidar.jpg" alt="USFS LiDAR Canopy Height Models">
        </div>
        <div class="project-hero-content">
            <div class="project-hero-inner">
                <a href="../index.html#portfolio" class="back-link">&larr; back to projects</a>
                <h1>USFS LiDAR Canopy Height Models</h1>
                <div class="project-meta">
                    <span>Python / PDAL / FUSION</span>
                    <span>Ongoing</span>
                </div>
            </div>
        </div>
    </header>

    <main class="project-main">
        <section class="project-section">
            <h2>Overview</h2>
            <p>In 2023 I worked with United States Forest Service (USFS) to produce Canopy Height Models (CHM) for 11 national forest areas in Mississippi and Missouri. A CHM is a raster image model where each cell (pixel) represents the average height of the tree canopy at that point. These products were created from USGS 3DEP LiDAR point-cloud datasets using a data pipeline I developed in Windows Batchscript utilizing the USFS's FUSION/LDV Command Line Toolkit.</p>
        </section>

        <section class="project-section">
            <h2>The Challenge</h2>
            <p>FUSION/LDV is very good at what it does, but it is complex and processor/memory intensive. Needing to use batchscript is a significant downside of using FUSION for this task. This isn't easy to do at large scales because a single forest area can comprise thousands of LiDAR Tiles, accumulating terabytes of data. Additionally, these files are often compressed and are 2-4x larger when uncompressed&mdash;which they must be to work with them.</p>
        </section>

        <section class="project-section">
            <h2>New Methodology</h2>
            <p>Throughout 2024, I, along with my colleague Kylie Wagner, began developing a new methodology for producing CHMs. Kylie aimed to use Esri ArcGIS Pro to achieve the same effect as the FUSION/LDV process. I developed an open-source approach in Python using the Point Data Abstraction Library (PDAL) and Rasterio.</p>
            <p>My Python method is still in progress, but I aim to publish my work in a peer-reviewed journal in 2025.</p>
        </section>

        <section class="project-section">
            <h2>About CHMs</h2>
            <p>Canopy Height Model (CHM) Raster products are crucial in ecological and forestry studies because they provide detailed insights into the vertical structure of vegetation. By measuring the height of the canopy, researchers can assess forest biomass, monitor changes in vegetation, and manage natural resources more effectively. These models are instrumental in biodiversity studies, carbon sequestration projects, and habitat modeling, helping to understand and mitigate the impacts of climate change.</p>
            <p>CHM products are derived from LiDAR (Light Detection and Ranging) datasets, which use laser pulses to measure distances between the sensor and objects on the ground. To create a CHM, two primary surfaces are extracted from the LiDAR point cloud: the Digital Terrain Model (DTM), representing the elevation of the bare earth, and the Digital Surface Model (DSM), representing the elevation of the objects above the ground, including tree canopies. The CHM is then generated by subtracting the DTM from the DSM.</p>
        </section>

        <section class="project-section">
            <h2>Gallery</h2>
            <div class="gallery-grid">
                <img src="../assets/lidar-canopy-height/gallery/Programmatic LiDAR Analysis Portfolio (1).png" alt="LiDAR Analysis Sample" data-caption="Example canopy height model output showing forest structure analysis.">
                <img src="../assets/lidar-canopy-height/gallery/Programmatic LiDAR Analysis Portfolio (2).jpg" alt="LiDAR Processing Workflow" data-caption="Visualization of the LiDAR processing pipeline using PDAL and Rasterio.">
                <img src="../assets/lidar-canopy-height/gallery/Programmatic LiDAR Analysis Portfolio (3).jpg" alt="CHM Comparison" data-caption="Comparative analysis of canopy height models generated using different methodologies.">
            </div>
        </section>

        <section class="project-section">
            <h2>Reports</h2>
            <p><button class="download-link" id="preview-btn">View CHM Comparative Methodology Report (PDF)</button></p>
            <p><button class="download-link" id="report-preview-btn">View Programmatic LiDAR Analysis Closure Report (PDF)</button></p>
        </section>

        <section class="project-section">
            <h2>Links & Resources</h2>
            <div class="links-grid">
                <a href="https://github.com/ASingleLostShoe/CanopyModel_PDAL" target="_blank" rel="noopener noreferrer" class="btn btn-primary">view on github</a>
            </div>
        </section>

        <!-- PDF Preview Modal (Methodology Report) -->
        <div class="pdf-modal" id="pdf-modal">
            <div class="pdf-modal-content">
                <div class="pdf-modal-header">
                    <span>CHM Comparative Methodology Report</span>
                    <div class="pdf-modal-actions">
                        <a href="../assets/lidar-canopy-height/CHM Comparative Methodology Report.pdf" class="pdf-download-btn" download>Download</a>
                        <button class="pdf-close-btn" id="pdf-close">&times;</button>
                    </div>
                </div>
                <iframe src="" id="pdf-iframe" class="pdf-iframe"></iframe>
            </div>
        </div>

        <!-- PDF Preview Modal (Closure Report) -->
        <div class="pdf-modal" id="report-modal">
            <div class="pdf-modal-content">
                <div class="pdf-modal-header">
                    <span>Programmatic LiDAR Analysis Closure Report</span>
                    <div class="pdf-modal-actions">
                        <a href="../assets/lidar-canopy-height/Programmatic LiDAR Analysis Closure Report.pdf" class="pdf-download-btn" download>Download</a>
                        <button class="pdf-close-btn" id="report-close">&times;</button>
                    </div>
                </div>
                <iframe src="" id="report-iframe" class="pdf-iframe"></iframe>
            </div>
        </div>

        <nav class="project-nav">
            <a href="cool-roofs-multispectral.html" class="project-nav-link prev">
                <span class="nav-label">previous</span>
                <span class="nav-title">Cool Roofs Multispectral Analysis</span>
            </a>
            <a href="geotiff-exporter.html" class="project-nav-link next">
                <span class="nav-label">next</span>
                <span class="nav-title">Bulk GeoTIFF Exporter</span>
            </a>
        </nav>
    </main>

    <footer class="footer">
        <p>&copy; 2025 Pat Hall</p>
    </footer>

    <!-- Lightbox -->
    <div class="lightbox" id="lightbox">
        <button class="lightbox-close" aria-label="Close">&times;</button>
        <button class="lightbox-prev" aria-label="Previous">&larr;</button>
        <button class="lightbox-next" aria-label="Next">&rarr;</button>
        <div class="lightbox-content">
            <img src="" alt="" id="lightbox-img">
            <p class="lightbox-caption" id="lightbox-caption"></p>
        </div>
        <div class="lightbox-counter" id="lightbox-counter"></div>
    </div>

    <script>
        const lightbox = document.getElementById('lightbox');
        const lightboxImg = document.getElementById('lightbox-img');
        const lightboxCaption = document.getElementById('lightbox-caption');
        const lightboxCounter = document.getElementById('lightbox-counter');
        const galleryImages = document.querySelectorAll('.gallery-grid img');
        let currentIndex = 0;

        function openLightbox(index) {
            currentIndex = index;
            updateLightbox();
            lightbox.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeLightbox() {
            lightbox.classList.remove('active');
            document.body.style.overflow = '';
        }

        function updateLightbox() {
            lightboxImg.src = galleryImages[currentIndex].src;
            lightboxImg.alt = galleryImages[currentIndex].alt;
            lightboxCaption.textContent = galleryImages[currentIndex].dataset.caption || '';
            lightboxCounter.textContent = `${currentIndex + 1} / ${galleryImages.length}`;
        }

        function prevImage() {
            currentIndex = (currentIndex - 1 + galleryImages.length) % galleryImages.length;
            updateLightbox();
        }

        function nextImage() {
            currentIndex = (currentIndex + 1) % galleryImages.length;
            updateLightbox();
        }

        galleryImages.forEach((img, index) => {
            img.addEventListener('click', () => openLightbox(index));
        });

        document.querySelector('.lightbox-close').addEventListener('click', closeLightbox);
        document.querySelector('.lightbox-prev').addEventListener('click', prevImage);
        document.querySelector('.lightbox-next').addEventListener('click', nextImage);

        lightbox.addEventListener('click', (e) => {
            if (e.target === lightbox) closeLightbox();
        });

        document.addEventListener('keydown', (e) => {
            if (!lightbox.classList.contains('active')) return;
            if (e.key === 'Escape') closeLightbox();
            if (e.key === 'ArrowLeft') prevImage();
            if (e.key === 'ArrowRight') nextImage();
        });

        // PDF Preview (Methodology Report)
        const pdfModal = document.getElementById('pdf-modal');
        const pdfIframe = document.getElementById('pdf-iframe');
        const pdfPath = '../assets/lidar-canopy-height/CHM Comparative Methodology Report.pdf';

        document.getElementById('preview-btn').addEventListener('click', () => {
            pdfIframe.src = pdfPath;
            pdfModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        });

        document.getElementById('pdf-close').addEventListener('click', () => {
            pdfModal.classList.remove('active');
            pdfIframe.src = '';
            document.body.style.overflow = '';
        });

        pdfModal.addEventListener('click', (e) => {
            if (e.target === pdfModal) {
                pdfModal.classList.remove('active');
                pdfIframe.src = '';
                document.body.style.overflow = '';
            }
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && pdfModal.classList.contains('active')) {
                pdfModal.classList.remove('active');
                pdfIframe.src = '';
                document.body.style.overflow = '';
            }
        });

        // Closure Report Preview
        const reportModal = document.getElementById('report-modal');
        const reportIframe = document.getElementById('report-iframe');
        const reportPath = '../assets/lidar-canopy-height/Programmatic LiDAR Analysis Closure Report.pdf';

        document.getElementById('report-preview-btn').addEventListener('click', () => {
            reportIframe.src = reportPath;
            reportModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        });

        document.getElementById('report-close').addEventListener('click', () => {
            reportModal.classList.remove('active');
            reportIframe.src = '';
            document.body.style.overflow = '';
        });

        reportModal.addEventListener('click', (e) => {
            if (e.target === reportModal) {
                reportModal.classList.remove('active');
                reportIframe.src = '';
                document.body.style.overflow = '';
            }
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && reportModal.classList.contains('active')) {
                reportModal.classList.remove('active');
                reportIframe.src = '';
                document.body.style.overflow = '';
            }
        });
    </script>
</body>
</html>
